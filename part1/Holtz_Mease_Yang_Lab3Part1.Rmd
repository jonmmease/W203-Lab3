---
title: "W203 Lab 3, Part 1: Reducing Crime"
author:
- Stephen Holtz
- Jon Mease
- Hong Yang

output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction and Research Question
As members of...

## Initial Data Loading and Cleaning
First we will load and examine the data set.
```{r}
crime_raw <- read.csv("../data/crime_v2.csv")
```

We note that the last 6 rows of the dataset are `NA` in all columns except `prbconv`. According to the codebook `prbconv` is a numeric variable representing the probability of conviction, but it has been loaded as a factor due to the presence of a backtick string character present in row 97.

```{r}
tail(crime_raw[,1:6], 10)
```

We remove last 6 rows from `crime_raw` and create a new data frame `crime` and convert `prbconv` from a factor into a numeric column.
```{r}
crime <- crime_raw[1:(nrow(crime_raw)-6),]
crime$prbconv <- as.numeric(levels(crime$prbconv)[crime$prbconv])
```

Next we examine the probability variables `prbarr`, `prbconv`, `prbpris`

```{r}
summary(crime[,c('prbarr', 'prbconv', 'prbpris')])
```
Here we see that all probability values are non-negative, but `prbarr` and `prbconv` each have values that are greater than one and therefore not valid probabilities. However, the codebook states that "the probability of arrest is proxied by the ratio of arrests to offenses" and "the probability of conviction is proxied by the ratio of convictions to arrests". By these caclulations, it is plausible that these probability proxy variables will have values larger than one, so we do not remove these observations at this time.

Next, we identified an unreasonably anonymous value for the service industry wage, `wser`, in row 84 for county 185.

```{r}
plot(crime$wser, main = 'Service industry weekly wage')
```

This extreme value (2177.0681) is 860% of the median (253.2) and 556% of the second largest wage in the dataset (391.3081).  Since the other remaining properties for this observation are all in reasonable ranges, with respect to the other observations in the sample, we will replace the anomolous value with `NA` rather than remove the entire observation.

```{r}
crime$wser[84] = NA
```

## The Model Building Process (Jon)

We will use the reported crime rate, `crmrte`, as our outcome variable.

### Outcome variabel: `crmrte`

```{r}
summary(crime$crmrte)
```

The mean is a bit larger than the median indicating a moderate positive skew.

```{r}
hist(crime$crmrte)
```

The histogram of `crmrte` confirms the skew and also shows that the distribution of `crmrte` is uniodal.

### Explanatory variable: `density`
Next we examine potential explanatory variables.  We start `density`, the number of persons per square mile.

```{r}
summary(crime$density)
```

Here the median is almost 1.5 times larger than the median, indicating a significant positive skew.

```{r}
hist(crime$density, breaks = 15)
```

The histogram of `density` confirms the large positive skew and shows that it has a unimodal distribution peaked at around 0.5-1.0 persons per square mile.


```{r}
plot(crime$density, crime$crmrte)
```

Based on the scatter plot, there appears to be a positive relationship between population density and crime rate.

### Explanatory variable: `prbarr`
Next we look at the probability of arrest (`prbarr`).

```{r}
summary(crime$prbarr)
```
The median is slightly larger than the mean, indicating a slight positive skew to the distribution.

```{r}
hist(crime$prbarr, breaks = 15)
```
The histogram shows that the distribution is unimodal, and that the slight positive skew is largely due to two outlying values.

```{r}
plot(crime$prbarr, crime$crmrte)
```

The relationship between the log of the probability of arrest and crime rate appears to be a bit more linear, so we will keep this transformation.
```{r}
plot(log(crime$prbarr), crime$crmrte)
```

TODO: Add discussion of rational for choosing these outcome and explanatory variables based on the research question. 

## The Model Building Process

## Regression Models (Jon)

```{r}
model1 <- lm(crime$crmrte ~ log(crime$prbarr) + crime$density)
model1
```

```{r}
summary(model1)
```

TODO: interpret
TODO: State/Evaluate CLM assumptions.


## Regression Models

### Regression Model 1

### Regression Model 2

### Regression Model 3

### Regression Table

## Omitted Variables Discussion

## Conclusion
