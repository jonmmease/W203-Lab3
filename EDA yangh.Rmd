---
title: "Lab 3"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

# Section 1: load crime data
```{r}
crime <- read.csv("crime_v2.csv")
summary(crime)
library(car)
```




# Section 2: Remove NAs, and row 79 which is a outlier has extream low density
```{r}


plot1 <- plot(log(crime$density), crime$crmrte)
crime$density[79]

nrow(crime)
DF_crime <- data.frame(na.omit(crime))
nrow(DF_crime)
DF_crime$prbconv=as.numeric(DF_crime$prbconv)
str(DF_crime)
DF_crime=DF_crime[-79,]
nrow(DF_crime)

```

# Section 3 - Examing the correlations

```{r}
dfnew1 <- na.omit(DF_crime[,c(3:25)])
nrow(dfnew1)

cor(dfnew1)
```

# Section 4: Log transformation for crmrte, prbarr, and density

```{r}
scatterplotMatrix(~crmrte+prbarr, data = DF_crime)
scatterplotMatrix(~log(crmrte)+log(prbarr), data = DF_crime)

scatterplotMatrix(~crmrte+density, data = DF_crime)
scatterplotMatrix(~log(crmrte)+log(density), data = DF_crime)

#crmrte+prbarr+prbconv+density+taxpc+density+taxpc+west+urban+wcon+wtrd+wfir+wmfg+wfed+wloc+pctymle



```

# Section 5 - Regression model

##Moedel 1 -  explanatory variables of key interest
### prbarr(because lower chance of arrest can lead to more crime)
### prbconv and prbpris (for similar reason as prbarr)
### polpc has strong positive correlation with prbarr, pctmin80 is included for the reason of political campaign.

```{r}
scatterplotMatrix(~log(crmrte)+log(prbarr), data = DF_crime)
scatterplotMatrix(~log(crmrte)+log(polpc), data = DF_crime)

(Model1 = lm(log(crmrte) ~ log(prbarr) + prbconv + prbpris + log(polpc) + pctmin80, data = DF_crime))
summary(Model1)$r.square

plot(Model1$fitted.values, Model3$residuals)

```



##Moedel 2  - Ddding density, wfed and wser to the key explanatory variables.  
### Density and urban are problematic, due to multicollinearity, correlation = .82
### Wages - one type goes up the other type tends to go up, they can tend to split the effect among themselves.  There is considerable amount of multicollinearity among the different wages.
### Also density and wages have some multicollinearity, which make sense since jobs in the city tend to have higher wages.
### Residuals apprear to be centered at 0, also we don't see any patterns in the residuals
### We noticed wser has one extra large wage of $2177.0681



```{r}

(Model2 = lm(log(crmrte) ~ log(prbarr) + prbconv + prbpris + log(polpc) + pctmin80 + log(density) + + wfed + wser, data = DF_crime))
summary(Model2)$r.square

plot(Model2$fitted.values, Model2$residuals)


(model2.1 = lm(log(crmrte) ~ log(prbarr) + prbconv + prbpris + log(polpc) + pctmin80 + urban, data = DF_crime))
summary(model2.1)$r.square



```

##Moedel 3  - Everything except west, urban and central
  
```{r}

(Model3 = lm(log(crmrte) ~ log(prbarr) + prbconv + prbpris + log(polpc) + pctmin80 + log(density) + wser + county + avgsen + taxpc + wcon + wtuc + wtrd + wfir + wmfg + wfed + wsta + wloc + mix + pctymle, data = DF_crime))
summary(Model3)$r.square

plot(Model3$fitted.values, Model3$residuals)

```


